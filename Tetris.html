s<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tetris</title>

    <style>

        body{
            margin: 16px;
            background-color: black;
        }

        .main-container{
            /*placeholder*/
        }
    
        .main-division{
            border: 1px solid red;
        }

        #board{
            display: grid;
            margin: auto;
        }
    
    </style>

</head>
<body>
    <div id="" class="main-container">

        <div id="board" class="main-division"></div>

    </div>

    <script>
    
        // variables for catching html elements
        let board = document.getElementById('board');

        // board grid - number of rows and columns
        let boardHeight = 20;
        let boardWidth = 10;

        // set board width and height in pixels
        let buildingBlockSize = 30;
        board.style.width = buildingBlockSize * boardWidth + "px";
        board.style.height = buildingBlockSize * boardHeight + "px";

        // global variables for game mechanics
        let boardMatrix = [];
        let activeTet;
        let direction;
        let blocks = [[],[],[],[]];
        let blockIndex;

        // set-up the grid inside the board
        board.style.gridTemplateColumns = "repeat(" + boardWidth + ", 1fr)";

        // creation of board elements for display of tetrominos
        for (let i = 0; i < boardHeight; i++) {
            for (let j = 0; j < boardWidth; j++) {
                let temp = document.createElement("div");
                temp.setAttribute('id', 'q-' + i + '-' + j);
                board.appendChild(temp);
            }
        }

        // initialize board matrix (here is where we store the fixed pieces later)
        for (let i = 0; i < boardHeight + 1; i++) {

            boardMatrix[i] = [];

            for (let j = 0; j < boardWidth; j++) {
                // if (i == boardHeight) {
                // boardMatrix [i][j] = 'x';
                // }
                // else {
                boardMatrix[i][j] = 0;
                //}
            }
        }

        let tetrominoColor = [

            "red",
            "blue",
            "yellow",
            "orange",
            "green",
            "purple",
            "white"
        ];

        let tetrominoType = [

            [
                [0, 1, 1],
                [1, 1, 0],
                [0, 0, 0]
            ],
            [
                [1, 1, 0],
                [0, 1, 1],
                [0, 0, 0]
            ],
            [
                [0, 1, 0],
                [1, 1, 1],
                [0, 0, 0]
            ],
            [
                [1, 0, 0],
                [1, 1, 1],
                [0, 0, 0]
            ],
            [
                [0, 0, 1],
                [1, 1, 1],
                [0, 0, 0]
            ],
            [
                [1, 1],
                [1, 1],
            ],
            [
                [0, 0, 0, 0],
                [1, 1, 1, 1],
                [0, 0, 0, 0],
                [0, 0, 0, 0]
            ],
        ]

        // define class Tetromino
        class Tetromino {
            constructor(type, color, xCoord, yCoord, orient) {
                this.type = type;
                this.color = color;
                this.xCoord = xCoord;
                this.yCoord = yCoord;
                this.orient = orient;
            }

            // draw a given tetromino piece inside the board in the given coordinates
            draw() {
                
                blockIndex = 0;
                let temp = this.type;

                for (let i = 0; i < temp.length; i++) {
                    for (let j = 0; j < temp.length; j++) {
                        if (temp[i][j] == 1) {
                            document.getElementById('q-' + (i + this.xCoord) + '-' + (j + this.yCoord)).style.backgroundColor = this.color;
                            blocks[blockIndex] = [i + this.xCoord, j + this.yCoord];
                            blockIndex++;
                        }
                    }
                }
            }

            erase() {

                    let temp = this.type;
                    for (let i = 0; i < temp.length; i++) {
                        for (let j = 0; j < temp.length; j++) {
                            if (temp[i][j] == 1) {
                                document.getElementById('q-' + (i + this.xCoord) + '-' + (j + this.yCoord)).style.backgroundColor = "";
                            }
                        }
                    }
                    blocks = [[],[],[],[]];
            }

            moveDown() {

                this.erase();
                this.xCoord += 1;
                this.draw();
            }

            moveLeft() {

                this.erase();
                this.yCoord -= 1;
                this.draw();
            }

            moveRight() {

                this.erase();
                this.yCoord += 1;
                this.draw();


            }

            rotate() {


                let temp = this.type;
                let temp2 = [];
                for (let i = 0; i < this.type.length; i++) {
                    temp2[i] = [];
                    for (let j = 0; j < this.type.length; j++) {
                        temp2[i][j] = temp[this.type.length - 1 - j][i];    
                    }
                    
                }
                if (this.type.length != 2) {

                    this.erase();
                    this.type = temp2;
                    this.draw();

                    this.orient++;
                    if (this.orient == 4) {
                        this.orient = 0;
                    }
                }               
            }
        }

        function checkCollision(piece, direction) {

            blockIndex = 0;
            blocks = [[0,0],[0,0],[0,0],[0,0]];
            for (let i = 0; i < piece.type.length; i++) {

                if (blockIndex > 3) {
                        break;
                    }

                for (let j = 0; j < piece.type.length; j++) {
                    
                    let temp = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j + piece.yCoord));

                    if (temp != null) {

                        if (temp.style.backgroundColor != "" && piece.type[i][j] == 1) {
                            blocks[blockIndex][0] = i + piece.xCoord;
                            blocks[blockIndex][1] = j + piece.yCoord;
                            blockIndex++;
                        }
                    }
                }
            }

            console.log(blocks);

            for (let i = 0; i < piece.type.length; i++) {
                for (let j = 0; j < piece.type.length; j++) {

                    let beyondEdgeBoole = withinBoard(i + piece.xCoord, j + piece.yCoord, direction);

                    // downward movement
                    if (direction == "down") {

                        if(beyondEdgeBoole) {

                            let temp = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j + piece.yCoord));
                            let temp2 = document.getElementById('q-' + (i + 1 + piece.xCoord) + '-' + (j + piece.yCoord));

                            if (isPartOfActiveTet(i + piece.xCoord, j + piece.yCoord, blocks)) {

                                if (temp2 == null) {

                                    return true;
                                }
                                else if (
                                            temp2.style.backgroundColor != "" &&
                                            !(isPartOfActiveTet(i + 1 + piece.xCoord, j + piece.yCoord, blocks))
                                ) {
                                    return true;
                                }
                            }
                        }
                    }

                    // leftward movement
                    if (direction == "left") {
                        
                        if (beyondEdgeBoole) {
                            
                            let temp = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j + piece.yCoord));
                            let temp2 = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j - 1 + piece.yCoord));

                            if (isPartOfActiveTet(i + piece.xCoord, j + piece.yCoord, blocks)) {
                                
                                if (temp2 == null) {
                                    
                                    return true;
                                }
                                else if (
                                    temp2.style.backgroundColor != "" &&
                                    !(isPartOfActiveTet(i + piece.xCoord, j - 1 + piece.yCoord, blocks))
                                ) {
                                    return true;
                                }
                            }
                        }
                    }

                    // rightward movement
                    if (direction == "right") {
                        
                        if (beyondEdgeBoole) {
                            
                            let temp = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j + piece.yCoord));
                            let temp2 = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j + 1 + piece.yCoord));

                            if (isPartOfActiveTet(i + piece.xCoord, j + piece.yCoord, blocks)) {
                                
                                if (temp2 == null) {

                                    return true;
                                }
                                else if (
                                    temp2.style.backgroundColor != "" &&
                                    !(isPartOfActiveTet(i + piece.xCoord, j + 1 + piece.yCoord, blocks))
                                ) {
                                    return true;
                                }
                            }
                        }
                    }
                }
            }

            // // from moveDown()
            // if (direction == "down") {
            //     for (let i = 0; i < piece.type.length; i++) {
            //         for (let j = 0; j < piece.type.length; j++) {
            //     //for (let i = piece.type.length - 1; i >= 0; i--) {
            //         //for (let j = piece.type.length - 1; j >= 0; j--) {
                        
            //             // non-existent elements should not be called
            //             if (
            //                 i + piece.xCoord >= 0 &&
            //                 i + piece.xCoord < boardHeight &&
            //                 j + piece.yCoord >= 0 &&
            //                 j + piece.yCoord < boardWidth
            //             ) {
                            
            //                 let temp = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j + piece.yCoord));
            //                 let temp2 = document.getElementById('q-' + (i + 1 + piece.xCoord) + '-' + (j + piece.yCoord));
            //                 console.log("down, " + isPartOfActiveTet(i + piece.xCoord, j + piece.yCoord, blocks));

            //                 if (
            //                     temp.style.backgroundColor != "" && 
            //                     (
            //                         isPartOfActiveTet(i + piece.xCoord, j + piece.yCoord, blocks)
            //                         // (i + piece.xCoord == blocks[0][0] && j + piece.yCoord == blocks[0][1]) ||
            //                         // (i + piece.xCoord == blocks[1][0] && j + piece.yCoord == blocks[1][1]) ||
            //                         // (i + piece.xCoord == blocks[2][0] && j + piece.yCoord == blocks[2][1]) ||
            //                         // (i + piece.xCoord == blocks[3][0] && j + piece.yCoord == blocks[3][1])
            //                     )
            //                 ) {
            //                     if (temp2 == null) {
            //                         console.log("collision!!!");

            //                         return true;
            //                     }
            //                     else if (
            //                             temp2.style.backgroundColor != "" && 
            //                             (
            //                                 !(isPartOfActiveTet(i + 1 + piece.xCoord, j + piece.yCoord, blocks))
            //                                 // (i + 1 + piece.xCoord != blocks[0][0] && j + piece.yCoord != blocks[0][1]) ||
            //                                 // (i + 1 + piece.xCoord != blocks[1][0] && j + piece.yCoord != blocks[1][1]) ||
            //                                 // (i + 1 + piece.xCoord != blocks[2][0] && j + piece.yCoord != blocks[2][1]) ||
            //                                 // (i + 1 + piece.xCoord != blocks[3][0] && j + piece.yCoord != blocks[3][1])
            //                             )
            //                     ) {
            //                         return true;
            //                     }
            //                 }
            //             }
            //         }
            //     }
            // }

            // // from moveLeft()
            // if (
            //     direction == "left" &&
            //     blocks[0][1] >= 0 &&
            //     blocks[1][1] >= 0 &&
            //     blocks[2][1] >= 0 &&
            //     blocks[3][1] >= 0
            // ) {

            //         for (let i = 0; i < piece.type.length; i++) {
            //             for (let j = 0; j < piece.type.length; j++) {
            //         //for (let i = piece.type.length - 1; i >= 0; i--) {
            //             //for (let j = piece.type.length - 1; j >= 0; j--) {

            //                 // non-existent elements should not be called
            //                 if (
            //                     i + piece.xCoord >= 0 &&
            //                     i + piece.xCoord < boardHeight &&
            //                     j + piece.yCoord >= 0 &&
            //                     j + piece.yCoord < boardWidth
            //                 ) {
            //                     let temp = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j + piece.yCoord));
            //                     let temp2 = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j - 1 + piece.yCoord));
            //                     console.log("left, " + isPartOfActiveTet(i + piece.xCoord, j + piece.yCoord, blocks));

            //                     if (
            //                         temp.style.backgroundColor != "" && 
            //                         (
            //                             isPartOfActiveTet(i + piece.xCoord, j + piece.yCoord, blocks)
            //                             // (i + piece.xCoord == blocks[0][0] && j + piece.yCoord == blocks[0][1]) ||
            //                             // (i + piece.xCoord == blocks[1][0] && j + piece.yCoord == blocks[1][1]) ||
            //                             // (i + piece.xCoord == blocks[2][0] && j + piece.yCoord == blocks[2][1]) ||
            //                             // (i + piece.xCoord == blocks[3][0] && j + piece.yCoord == blocks[3][1])
            //                         )
            //                     ) {
            //                         if (temp2 == null) {
            //                             console.log("collision!!!");

            //                             return true;
            //                         }
            //                         else if (
            //                                 temp2.style.backgroundColor != "" && 
            //                                 (
            //                                     !(isPartOfActiveTet(i + piece.xCoord, j - 1 + piece.yCoord, blocks))
            //                                     // (i + piece.xCoord != blocks[0][0] && j - 1 + piece.yCoord != blocks[0][1]) ||
            //                                     // (i + piece.xCoord != blocks[1][0] && j - 1 + piece.yCoord != blocks[1][1]) ||
            //                                     // (i + piece.xCoord != blocks[2][0] && j - 1 + piece.yCoord != blocks[2][1]) ||
            //                                     // (i + piece.xCoord != blocks[3][0] && j - 1 + piece.yCoord != blocks[3][1])
            //                                 )
            //                         ) {
            //                             return true;
            //                         }
            //                     }
            //                 }
            //             }
            //         }
            //     }
            

            // // from moveRight()
            // if (direction == "right") {
            //     for (let i = 0; i < piece.type.length; i++) {
            //         for (let j = 0; j < piece.type.length; j++) {
            //     // for (let i = piece.type.length - 1; i >= 0; i--) {
            //     //     for (let j = piece.type.length - 1; j >= 0; j--) {

            //             // non-existent elements should not be called
            //             if (
            //                 i + piece.xCoord >= 0 &&
            //                 i + piece.xCoord < boardHeight &&
            //                 j + piece.yCoord >= 0 &&
            //                 j + piece.yCoord < boardWidth
            //             ) {
            //                 let temp = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j + piece.yCoord));
            //                 let temp2 = document.getElementById('q-' + (i + piece.xCoord) + '-' + (j + 1 + piece.yCoord));
            //                 console.log("right, " + isPartOfActiveTet(i + piece.xCoord, j + piece.yCoord, blocks));

            //                 if (
            //                     temp.style.backgroundColor != "" && 
            //                     (
            //                         isPartOfActiveTet(i + piece.xCoord, j + piece.yCoord, blocks)
            //                         // (i + piece.xCoord == blocks[0][0] && j + piece.yCoord == blocks[0][1]) ||
            //                         // (i + piece.xCoord == blocks[1][0] && j + piece.yCoord == blocks[1][1]) ||
            //                         // (i + piece.xCoord == blocks[2][0] && j + piece.yCoord == blocks[2][1]) ||
            //                         // (i + piece.xCoord == blocks[3][0] && j + piece.yCoord == blocks[3][1])
            //                     )
            //                 ) {
            //                     if (temp2 == null) {
            //                         console.log("collision!!!");

            //                         return true;
            //                     }
            //                     else if (
            //                             temp2.style.backgroundColor != "" && 
            //                             (
            //                                 !(isPartOfActiveTet(i + piece.xCoord, j + 1 + piece.yCoord, blocks))
            //                                 // (i + piece.xCoord != blocks[0][0] && j + 1 + piece.yCoord != blocks[0][1]) ||
            //                                 // (i + piece.xCoord != blocks[1][0] && j + 1 + piece.yCoord != blocks[1][1]) ||
            //                                 // (i + piece.xCoord != blocks[2][0] && j + 1 + piece.yCoord != blocks[2][1]) ||
            //                                 // (i + piece.xCoord != blocks[3][0] && j + 1 + piece.yCoord != blocks[3][1])
            //                             )
            //                     ) {
            //                         return true;
            //                     }

            //                 }
            //             }
            //         }
            //     }
            // }

            // from rotate()
            if (direction == "rot") {

            }

            // default function return
            console.log("NO collision");
            return false;
        }

        function isPartOfActiveTet(coordX, coordY, blk) {
            for (let i = 0; i < blk.length; i++) {
                if (coordX == blk[i][0] && coordY == blk[i][1]) {
                    return true;
                }
            }
            return false;
        }

        function withinBoard(coordX, coordY, dir) {
            if (direction == "down") {
                if (coordX >= boardHeight) {
                    return false;
                }
                return true;
            }
            if (direction == "left") {
                if (coordY < 0) {
                    return false;
                }
                return true;
            }
            if (direction == "right") {
                if (coordY >= boardWidth) {
                    return false;
                }
                return true;
            }
        }

        document.addEventListener('keydown', function (e) {
            //console.log(e.keyCode);
            if (e.keyCode == 87) {
                // user pressed 'w' for up
                direction = "rot";
                if (!(checkCollision(activeTet, direction))) {

                    activeTet.rotate();
                }
            }
            if (e.keyCode == 68) {
                // user pressed 'd' for right
                direction = "right";
                if (!(checkCollision(activeTet, direction))) {
                    activeTet.moveRight();
                }
            }
            if (e.keyCode == 83) {
                // user pressed "s" for down
                direction = "down";
                if (!(checkCollision(activeTet, direction))) {
                    activeTet.moveDown();
                }
                else {
                    console.log("can't move downwards - about to create new!!!");
                    createNew();
                }
                // if (checkCollision(activeTet, direction)) {
                //     createNew();
                // }
            }
            if (e.keyCode == 65) {
                // user pressed 'a' for left
                direction = "left";
                if (!(checkCollision(activeTet, direction))) {
                    activeTet.moveLeft();
                }
            }
            //console.log(boardMatrix);
            console.log(activeTet.xCoord + ", " + activeTet.yCoord);
        });

        function createNew() {            
            let selectedPiece = 4;
            activeTet = new Tetromino(tetrominoType[selectedPiece], tetrominoColor[selectedPiece], 0, 2, 0);
            activeTet.draw();
        }

        createNew();
    
    </script>
</body>
</html>
